<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Pixel Event Sender</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
        <div class="text-center mb-8">
            <div class="bg-gradient-to-r from-pink-500 to-purple-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-5.2 1.74 2.89 2.89 0 012.31-4.64 2.93 2.93 0 01.88.13V9.4a6.84 6.84 0 00-1-.05A6.33 6.33 0 005 20.1a6.34 6.34 0 0010.86-4.43v-7a8.16 8.16 0 004.77 1.52v-3.4a4.85 4.85 0 01-1-.1z"/>
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-gray-800">TikTok Pixel</h1>
            <p class="text-gray-600 mt-2">Envie eventos para o seu pixel</p>
        </div>

        <form id="pixelForm" class="space-y-6">
            <div>
                <label for="pixelId" class="block text-sm font-semibold text-gray-700 mb-2">
                    Pixel ID
                </label>
                <input 
                    type="text" 
                    id="pixelId" 
                    required
                    placeholder="ID do seu pixel"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition"
                />
            </div>

            <div>
                <label for="eventType" class="block text-sm font-semibold text-gray-700 mb-2">
                    Tipo de Evento
                </label>
                <select 
                    id="eventType" 
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition bg-white"
                >
                    <option value="">Selecione um evento</option>
                    <option value="ViewContent">ViewContent</option>
                    <option value="ClickButton">ClickButton</option>
                    <option value="AddToCart">AddToCart</option>
                    <option value="InitiateCheckout">InitiateCheckout</option>
                    <option value="AddPaymentInfo">AddPaymentInfo</option>
                    <option value="CompletePayment">CompletePayment</option>
                    <option value="PlaceAnOrder">PlaceAnOrder</option>
                    <option value="Contact">Contact</option>
                    <option value="Download">Download</option>
                    <option value="SubmitForm">SubmitForm</option>
                    <option value="Subscribe">Subscribe</option>
                </select>
            </div>

            <div>
                <label for="eventValue" class="block text-sm font-semibold text-gray-700 mb-2">
                    Valor (opcional)
                </label>
                <input 
                    type="number" 
                    id="eventValue" 
                    step="0.01"
                    placeholder="Ex: 99.90"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition"
                />
            </div>

            <button 
                type="submit" 
                id="submitBtn"
                class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold py-3 px-6 rounded-lg hover:from-pink-600 hover:to-purple-700 transition transform hover:scale-105 shadow-lg"
            >
                Enviar Evento
            </button>
        </form>

        <div id="result" class="mt-6 hidden">
            <div class="p-4 rounded-lg" id="resultBox">
                <p class="text-sm font-semibold" id="resultText"></p>
            </div>
        </div>

        <div id="pixelStatus" class="mt-6 p-4 bg-gray-100 rounded-lg">
            <p class="text-xs text-gray-600 text-center">
                Status: <span id="statusText" class="font-semibold text-gray-800">Aguardando configuração</span>
            </p>
        </div>
    </div>

    <script>
        let ttq = null;
        const form = document.getElementById('pixelForm');
        const resultDiv = document.getElementById('result');
        const resultBox = document.getElementById('resultBox');
        const resultText = document.getElementById('resultText');
        const submitBtn = document.getElementById('submitBtn');
        const statusText = document.getElementById('statusText');
        const pixelIdInput = document.getElementById('pixelId');

        // Função para carregar o pixel do TikTok
        function loadTikTokPixel(pixelId) {
            // Remove pixel anterior se existir
            if (window.ttq) {
                delete window.ttq;
            }

            // Carrega o script do TikTok Pixel
            !function (w, d, t) {
                w.TiktokAnalyticsObject=t;
                var ttq=w[t]=w[t]||[];
                ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"];
                ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};
                for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);
                ttq.instance=function(t){for(var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e};
                ttq.load=function(e,n){var i="https://analytics.tiktok.com/i18n/pixel/events.js";
                ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=i,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};
                var o=document.createElement("script");
                o.type="text/javascript",o.async=!0,o.src=i+"?sdkid="+e+"&lib="+t;
                var a=document.getElementsByTagName("script")[0];
                a.parentNode.insertBefore(o,a)};
            }(window, document, 'ttq');

            // Inicializa o pixel
            ttq.load(pixelId);
            ttq.page();
            
            window.ttq = ttq;
            
            statusText.textContent = `Pixel ${pixelId} carregado`;
            statusText.className = 'font-semibold text-green-600';
        }

        // Carrega o pixel quando o ID for inserido
        pixelIdInput.addEventListener('blur', function() {
            const pixelId = this.value.trim();
            if (pixelId) {
                loadTikTokPixel(pixelId);
            }
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const pixelId = document.getElementById('pixelId').value.trim();
            const eventType = document.getElementById('eventType').value;
            const eventValue = document.getElementById('eventValue').value;

            if (!window.ttq) {
                loadTikTokPixel(pixelId);
                // Aguarda um momento para o pixel carregar
                await new Promise(resolve => setTimeout(resolve, 1000));
            }

            resultDiv.classList.add('hidden');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Enviando...';

            try {
                // Prepara os dados do evento
                const eventData = {};
                
                if (eventValue) {
                    eventData.value = parseFloat(eventValue);
                    eventData.currency = 'BRL';
                }

                // Envia o evento
                window.ttq.track(eventType, eventData);

                // Aguarda um pouco para garantir o envio
                await new Promise(resolve => setTimeout(resolve, 500));

                // Mostra sucesso
                resultDiv.classList.remove('hidden');
                resultBox.className = 'p-4 rounded-lg bg-green-100 border border-green-400';
                resultText.className = 'text-sm font-semibold text-green-800';
                resultText.textContent = `✓ Evento "${eventType}" enviado com sucesso!`;

            } catch (error) {
                resultDiv.classList.remove('hidden');
                resultBox.className = 'p-4 rounded-lg bg-red-100 border border-red-400';
                resultText.className = 'text-sm font-semibold text-red-800';
                resultText.textContent = `✗ Erro ao enviar evento: ${error.message}`;
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Enviar Evento';
            }
        });
    </script>
</body>
</html>
